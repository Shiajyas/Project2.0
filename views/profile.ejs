<%- include('./partials/header') %>

<style>
    .alert {
    margin: 0 auto; /* Center align horizontally */
    width: fit-content; /* Make the width fit content */
    align-items: self-end;
}
</style>


    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Pages
                    <span></span> Account
                </div>
            </div>
        </div>
      
        <section class="pt-150 pb-150">
         
            <div class="container ">
                <div class="col-md-5 text-center">
                    <% if (success && success.length > 0) { %>
                        <!-- Display success messages -->
                        <div class="alert alert-dismissible font-weight-bold" style=" border: 1px solid black; ;">
                            <p><%= success[0] %></p> <!-- Display only the first success message -->
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    <% } %>
                </div>
                
                <div class="row">
                
                    <div class="col-lg-10 m-auto">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                                href="#dashboard" role="tab" aria-controls="dashboard"
                                                aria-selected="false"><i
                                                    class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                                role="tab" aria-controls="orders" aria-selected="false"><i
                                                    class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab"
                                                href="#track-orders" role="tab" aria-controls="track-orders"
                                                aria-selected="false"><i
                                                    class="fi-rs-shopping-cart-check mr-10"></i>Wallet Status</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab"
                                                href="#wallet-history" role="tab" aria-controls="track-orders"
                                                aria-selected="false"><i
                                                    class="fi-rs-shopping-cart-check mr-10"></i>Wallet History</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab"
                                                href="#referal" role="tab" aria-controls="track-orders"
                                                aria-selected="false"><i
                                                    class="fi-rs-shopping-cart-check mr-10"></i>Referals</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                                role="tab" aria-controls="address" aria-selected="true"><i
                                                    class="fi-rs-marker mr-10"></i>My Address</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab"
                                                href="#account-detail" role="tab" aria-controls="account-detail"
                                                aria-selected="true"><i class="fi-rs-sign-out mr-10"></i>Account
                                                details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="/user/forgetPassword"><i
                                                    class="fi-rs-sign-in mr-10"></i>Rest password</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="/user/logout"><i
                                                    class="fi-rs-sign-out mr-10"></i>Logout</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="tab-content dashboard-content">
                                    <div class="tab-pane fade show active" id="dashboard" role="tabpanel"
                                        aria-labelledby="dashboard-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">User Profile</h5>
                                            </div>
                                            <div class="card-body text-center">
                                                <% if (user.images && user.images.length > 0) { %>
                                                    <img src="<%= user.images[0] %>"
                                                        class="card-img-top rounded-circle mx-auto mt-3" alt="Profile Image"
                                                        style="width: 100px; height: 100px; object-fit: cover;">
                                                <% } else { %>
                                                    <!-- Default profile image -->
                                                    <img src="/user-assets/imgs/theme/icons/user-profile.svg"
                                                        class="card-img-top rounded-circle mx-auto mt-3" alt="Profile Image"
                                                        style="width: 100px; height: 100px; object-fit: cover;">
                                                <% } %>
                                                <div class="card-body text-center">
                                                    <h5 class="card-title">
                                                        <%= user.username %>
                                                    </h5>
                                                    <p class="card-text"><strong>Email:</strong>
                                                        <%= user.email %>
                                                    </p>
                                                    <p class="card-text"><strong>Phone:</strong>
                                                        <%= user.contact %>
                                                    </p>
                                                    <p class="card-text"><strong>Account Id:</strong>
                                                        <%= user._id %>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Your Orders</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table">
                                                        <thead>
                                                            <tr>
                                                                <th>Order</th>
                                                                <th>Status</th>
                                                                <th>Total</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>

                                                            <% if (order) { %>

                                                                <% for (let i=0; i < order.length; i++) { %>
                                                                    <tr>
                                                                        <td>
                                                                            <%= order[i]._id %>
                                                                        </td>

                                                                        <td>
                                                                            <%= order[i].status %>
                                                                        </td>


                                                                        <td>
                                                                            <%= order[i].totalPrice %>
                                                                        </td>


                                                                        <td><a href="/user/orderDetails?id=<%= order[i]._id %>"
                                                                                class="btn-small d-block">View</a></td>
                                                                    </tr>
                                                                    <% } %>


                                                                        <% }else{ %>

                                                                            <td>No Orders found</td>

                                                                            <% } %>

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="track-orders" role="tabpanel"
                                        aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Wallet</h5>
                                            </div>
                                            <div class="card-body contact-from-area">

                                                <div class="row">
                                                    <div class="col-lg-8 mx-auto text-center mt-90">
                                                        <form>
                                                            <div class="form-group">
                                                                <label for="walletAmount" class="h4">Amount</label>
                                                                <div class="h3">₹<%= user.wallet %>
                                                                </div>
                                                            </div>

                                                            <button type="button" class="btn btn-success"
                                                                onclick="addMoney()">Add Money</button>
                                                        </form>
                                                    </div>
                                                </div>



                                            </div>
                                        </div>
                                    </div>







                                    <div class="tab-pane fade" id="wallet-history" role="tabpanel"
                                        aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Wallet History</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table">
                                                        <thead>
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Status</th>
                                                                <th>Amount</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>

                                                            <% if (user.history) { %>

                                                                <% for (let i=0; i < user.history.length; i++) { %>
                                                                    <tr>
                                                                        <td>
                                                                            <% const dateObject=(user.history[i].date
                                                                                instanceof Date) ? user.history[i].date
                                                                                : new Date(user.history[i].date); %>
                                                                                <%= dateObject.toLocaleDateString() %>
                                                                        </td>

                                                                        <td>
                                                                            <%= user.history[i].status %>
                                                                        </td>
                                                                        <td>
                                                                            <% if (user.history[i].status==="debit" ) {
                                                                                %>
                                                                                -<%= user.history[i].amount %>
                                                                                    <% }else{ %>
                                                                                        <%= user.history[i].amount %>
                                                                                            <% } %>
                                                                        </td>
                                                                    </tr>
                                                                    <% } %>

                                                                        <% }else{ %>

                                                                            <td>No Orders found</td>

                                                                            <% } %>

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>







                                    <div class="tab-pane fade" id="referal" role="tabpanel"
                                        aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Referal Offer</h5>
                                            </div>
                                            <div class="card-body contact-from-area">

                                                <div class="row">
                                                    <div class="col-lg-8 mx-auto text-center mt-50">
                                                        <form onsubmit="verifyReferalCode(event)" method="post" action="">
                                                            <div class="form-group">
                                                                <label for="walletAmount" class="h4">Your referal
                                                                    code</label>
                                                                <% if (locals.user.referalCode) { %>
                                                                    <br>
                                                                    <h5>
                                                                        <%= locals.user.referalCode %>
                                                                    </h5>
                                                                    <% }else{ %>
                                                                        <br>
                                                                        <h5>No referal code found</h5>
                                                                        <% } %>
                                                            </div>

                                                            <div class="mt-60">
                                                                <h5>Do you have a code?</h5>
                                                                <br>
                                                                <input class="border-1" id="referalCode" type="text"
                                                                    name="referalCode" required
                                                                    style="border: 1px solid #000; width: 200px;">
                                                                <br><br>
                                                                <button type="submit">Get reward</button>
                                                            </div>

                                                        </form>
                                                    </div>
                                                </div>



                                            </div>
                                        </div>
                                    </div>







                                    <div class="tab-pane fade" id="address" role="tabpanel"
                                        aria-labelledby="address-tab">
                                        <div class="row">

                                            <%if(userAddress){%>
                                                <%userAddress.address.forEach((address)=>{%>
                                                    <div class="col-lg-6">
                                                        <div class="card  mb-3 mb-lg-0">
                                                            <div class="card-header">
                                                                <h5 class="mb-0">
                                                                    <%=address.addressType%>
                                                                </h5>
                                                            </div>

                                                            <div class="card-body">
                                                                <address>
                                                               <p><strong>Name: <%= address.username %></strong></p><br>
                                                                 <p>City: <%= address.city %></p>
                                                                <p>Landmark: <%= address.landMark %></p>
                                                                 <p>State: <%= address.state %></p> 
                                                            
                                                              <p>Pincode: <%= address.pincode %></p>
                                                              <p>Phone: <%= address.contact%></p>
                                                              <p>Alternate Phone: <%= address.altPhone %></p>
                                                            </address>
                                                              
                                                                <div class="d-flex justify-content-between">
                                                                    <a href="/user/editAddress?id=<%=address._id%>"
                                                                        class="btn-small">Edit</a>
                                                                    <a href="/user/deleteAddress?id=<%=address._id%>"
                                                                        class="btn-small">Delete</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <%})%>
                                                        <%}else{%>
                                                            <div class="col-lg-6">
                                                                <div class="card  mb-3 mb-lg-0">
                                                                    <div class="card-header">
                                                                        <h5 class="mb-0"></h5>
                                                                    </div>
                                                                    <div class="card-body">
                                                                        <address>
                                                                            No address
                                                                        </address>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <%}%>
                                                                <div>
                                                                    <a href="/user/addAddress">
                                                                        <button class="btn btn-primary w-70">Add
                                                                            address</button>
                                                                    </a>
                                                                </div>


                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="account-detail" role="tabpanel"
                                        aria-labelledby="account-detail-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Account Details</h5>
                                            </div>
                                            <div class="card-body">

                                                <form method="post" action="/user/editUserDetails?id=<%= user._id %>">
                                                    <div class="row">
                                                        <div class="form-group col-md-6">
                                                            <label> Name <span class="required">*</span></label>
                                                            <input required="" value="<%= user.username %>"
                                                                class="form-control square" name="username" type="text">
                                                        </div>

                                                        <div class="form-group col-md-12">
                                                            <label>Mobile Number <span class="required">*</span></label>
                                                            <input required="" value="<%= user.contact %>"
                                                                class="form-control square" name="contact" type="text">
                                                        </div>
                                                        <div class="col-md-12 mt-15">
                                                            <button type="submit" class="btn btn-fill-out submit"
                                                                name="submit" value="Submit">Save</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
        <script>
            async function addMoney() {
               
                const { value: amount } = await Swal.fire({
                    title: 'Enter the Amount',
                    input: 'number',
                    inputLabel: 'Amount',
                    inputPlaceholder: '₹'
                })
                $.ajax({
                    url: "/user/addMoney",
                    method: "post",
                    data: {
                        total: amount
                    },
                    success: (data) => {
                        if (data.razorpay) {
                            var options = {
                                "key": "rzp_test_kkytoEMYHJ1dn3",
                                "amount": data.order.amount,
                                "currency": "INR",
                                "name": "LapLux",
                                "description": "Test Transaction",
                                "image": "https://example.com/your_logo",
                                "order_id": data.order.id,
                                "handler": function (response) {
                                    verifyPayment(response, data);
                                },
                                "prefill": {
                                    "name": "Customer Name",
                                    "email": "customer@example.com",
                                    "contact": "9000090000"
                                },

                                "theme": {
                                    "color": "#3399cc"
                                }
                            }
                            console.log(options);
                            var rzp1 = new Razorpay(options);
                            rzp1.open();
                        }
                    }
                })
            }



            function verifyPayment(response, order) {

                $.ajax({
                    url: '/user/verify-payment',
                    method: 'post',
                    data: {
                        order,
                        response,
                        from: "wallet"
                    }, success: (response) => {
                        if (response) {
                            Swal.fire({
                                title: "Success",
                                text: "Payment has been succeed",
                                icon: "success",

                            }).then(function () {
                                location.reload()
                            });
                        } else {
                            Swal.fire("PAYMENT ERROR!", "Something wrong occured while processing the payment.", "error");
                            location.reload()
                        }

                    }
                })
            }


            function verifyReferalCode() {
                event.preventDefault();
                let referalCode = document.getElementById("referalCode").value
          
                $.ajax({
                    url: "/verifyReferalCode",
                    method: "post",
                    data: {
                        referalCode
                    },
                    success: (response) => {
                        console.log(response.message);
                        if (response.message == "Referral code verified successfully!") {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success!',
                                text: 'Referal offer redeemed successfully!',
                            })
                        }else if(response.message == "You have already used this referral code!"){
                            Swal.fire({
                                icon: 'warning',
                                title: 'Oops',
                                text: 'You have already used this referral code!',
                            })
                        }else if(response.message == "Invalid referral code!"){
                            Swal.fire({
                                icon: 'warning',
                                title: 'Oops',
                                text: 'Invalid referral code!',
                            }) 
                        }else if(response.message == "You have already redeemed a referral code before!"){
                            Swal.fire({
                                icon: 'warning',
                                title: 'Oops',
                                text: 'You have already redeemed a referral code before!',
                            }) 
                        }else{
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: '',
                            })
                        }


                    }
                })
            }



        </script>


        <footer class="main">
        <section class="newsletter p-30 text-white wow fadeIn animated">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-7 mb-md-3 mb-lg-0">
                        <div class="row align-items-center">
                            <div class="col flex-horizontal-center">
                                <img class="icon-email" src="assets/imgs/theme/icons/icon-email.svg" alt="">
                                <h4 class="font-size-20 mb-0 ml-3">Sign up to Newsletter</h4>
                            </div>
                            <div class="col my-4 my-md-0 des">
                                <h5 class="font-size-15 ml-4 mb-0">...and receive <strong>$25 coupon for first shopping.</strong></h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <!-- Subscribe Form -->
                        <form class="form-subcriber d-flex wow fadeIn animated">
                            <input type="email" class="form-control bg-white font-small" placeholder="Enter your email">
                            <button class="btn bg-dark text-white" type="submit">Subscribe</button>
                        </form>
                        <!-- End Subscribe Form -->
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding footer-mid">
            <div class="container pt-15 pb-20">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="widget-about font-md mb-md-5 mb-lg-0">
                            <div class="logo logo-width-1 wow fadeIn animated">
                                <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                            </div>
                            <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                            <p class="wow fadeIn animated">
                                <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                            </p>
                            <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
                            <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                                <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3">
                        <h5 class="widget-title wow fadeIn animated">About</h5>
                        <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Delivery Information</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms &amp; Conditions</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Support Center</a></li>
                            <li><a href="/admin/login">Administrator</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-2  col-md-3">
                        <h5 class="widget-title wow fadeIn animated">My Account</h5>
                        <ul class="footer-list wow fadeIn animated">
                            <li><a href="/user/signup">Sign In</a></li>
                            <li><a href="#">View Cart</a></li>
                            <li><a href="#">My Wishlist</a></li>
                            <li><a href="#">Track My Order</a></li>
                            <li><a href="#">Help</a></li>
                            <li><a href="#">Order</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-4">
                        <h5 class="widget-title wow fadeIn animated">Install App</h5>
                        <div class="row">
                            <div class="col-md-8 col-lg-12">
                                <p class="wow fadeIn animated">From App Store or Google Play</p>
                                <div class="download-app wow fadeIn animated">
                                    <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active" src="assets/imgs/theme/app-store.jpg" alt=""></a>
                                    <a href="#" class="hover-up"><img src="assets/imgs/theme/google-play.jpg" alt=""></a>
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                                <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                                <img class="wow fadeIn animated" src="assets/imgs/theme/payment-method.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="container pb-20 wow fadeIn animated">
            <div class="row">
                <div class="col-12 mb-20">
                    <div class="footer-bottom"></div>
                </div>
                <div class="col-lg-6">
                    <p class="float-md-left font-sm text-muted mb-0">&copy; 2022, <strong class="text-brand">Evara</strong> - HTML Ecommerce Template </p>
                </div>
                <div class="col-lg-6">
                    <p class="text-lg-end text-start font-sm text-muted mb-0">
                        Designed by <a href="http://alithemes.com/" target="_blank">Alithemes.com</a>. All rights reserved
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-10">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Vendor JS-->
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="assets/js/plugins/slick.js"></script>
    <script src="assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="assets/js/plugins/wow.js"></script>
    <script src="assets/js/plugins/jquery-ui.js"></script>
    <script src="assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="assets/js/plugins/magnific-popup.js"></script>
    <script src="assets/js/plugins/select2.min.js"></script>
    <script src="assets/js/plugins/waypoints.js"></script>
    <script src="assets/js/plugins/counterup.js"></script>
    <script src="assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="assets/js/plugins/images-loaded.js"></script>
    <script src="assets/js/plugins/isotope.js"></script>
    <script src="assets/js/plugins/scrollup.js"></script>
    <script src="assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="assets/js/plugins/jquery.theia.sticky.js"></script>
    <script src="assets/js/plugins/jquery.elevatezoom.js"></script>
    <!-- Template  JS -->
    <script src="assets/js/maind134.js?v=3.4"></script>
    <script src="assets/js/shopd134.js?v=3.4"></script>


</body>


<!-- Mirrored from wp.alithemes.com/html/evara/evara-frontend/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 15 Jul 2023 10:09:48 GMT -->
</html>